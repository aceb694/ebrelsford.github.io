<!DOCTYPE html>
<html>
    <head>
        <title>Class 4 | Advanced GIS</title>
        <meta charset="utf-8"> 
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />

        <link href='http://fonts.googleapis.com/css?family=Ledger' rel='stylesheet' type='text/css'>
        <link href='http://fonts.googleapis.com/css?family=Inconsolata:400,700' rel='stylesheet' type='text/css'>

        <link href="css/pig.css" rel="stylesheet" type="text/css" />
        <link href="css/base.css" rel="stylesheet" />

        <script src="http://ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
        <script src="http://benpickles.github.io/onScreen/jquery.onscreen.min.js"></script>
        <script src="js/pig.js"></script>

        <script>
            $(document).ready(function() {
                $(document).on('scroll', function () {
                    var hue = Math.random() * 360,
                        saturation = Math.random() * 100,
                        lightness = Math.random() * 100,
                        color = 'hsl(' + hue + ',' + saturation + '%,' + lightness + '%)';
                    $('.slide:onScreen')
                        .css('background-color', color)
                        .toggleClass('dark-background', lightness < 50);
                });
            });
        </script>
    </head>
    <body>

        <div class="slide lonely">
            <h2>CartoCSS</h2>
        </div>

        <div class="slide lonely">
            <pre>#earthquakes {
    marker-fill: #ff307a;
    marker-line-color: #FFF;
    marker-line-width: 0.25;
    marker-line-opacity: 0.4;
    marker-width: 2;
    marker-allow-overlap: true;
}</pre>
        </div>

        <div class="slide lonely">
            <pre>
#earthquakes {
    marker-width: 3;
    ...
    [mag >= 6.5] {
        marker-width: 8;
    }
}</pre>
        </div>

        <div class="slide lonely">
            <pre>
#earthquakes {
    marker-width: 3;
    ...
    [zoom &gt;= 10][zoom < 16] {
        marker-width: 8;
    }
}</pre>
        </div>

        <div class="slide lonely">
            <pre style="font-size: 50px; line-height: 70px;">
#earthquakes {
    marker-width: 3;
    ...
    [mag &gt; 5.5],
    [place = 'Northern Mid-Atlantic Ridge'] {
        marker-width: 8;
    }
}</pre>
        </div>

        <div class="slide lonely">
            <pre style="font-size: 40px; line-height: 50px;">@width: 8;
#earthquakes {
    marker-width: @width;
    marker-fill: #ff307a;
    marker-allow-overlap: true;
    
    [zoom >= 4] {
        marker-width: @width * 2;
    }
    [zoom >= 8] {
        marker-width: @width * 3;
    }
    [zoom >= 12] {
        marker-width: @width * 4;
    }
}</pre>
        </div>

        <div class="slide intermission"></div>

        <div class="slide lonely">
            <h1>Advanced GIS</h1>
            <p>Class 4</p>
        </div>

        <div class="slide intermission"></div>

        <div class="slide lonely">
            <img src="img/cartodb-filters.png" />
        </div>

        <div class="slide lonely">
            <img src="img/cartodb-filters-specific.gif" />
        </div>

        <div class="slide lonely">
            <h2>but I wanted <strong>6.5</strong>!</h2>
        </div>

        <div class="slide lonely">
            <h2>SQL</h2>
        </div>

        <div class="slide lonely">
            <h2>SQL</h2>
            <h2>Structured Query Language</h2>
        </div>

        <div class="slide lonely">
            <h2>SQL</h2>
            <h2>the language databases understand</h2>
        </div>

        <div class="slide lonely">
            <img src="img/cartodb-table.png" />
        </div>

        <div class="slide lonely">
            <img style="float: left; max-width: 50%;" src="img/paper.jpg" />
        </div>

        <div class="slide lonely">
            <img style="float: left; max-width: 50%;" src="img/paper.jpg" />
            <div style="float: left; width: 50%;">
                <div style="margin-left: 25px;">
                    <p>Give me the pages that refer to properties in Brooklyn.</p>
                </div>
            </div>
        </div>

        <div class="slide lonely">
            <img style="float: left; max-width: 50%;" src="img/paper.jpg" />
            <div style="float: left; width: 50%;">
                <div style="margin-left: 25px;">
                    <p>Give me the addresses of the properties in Brooklyn.</p>
                </div>
            </div>
        </div>

        <div class="slide lonely">
            <h2>databases are great at these types of questions</h2>
        </div>

        <div class="slide lonely">
            <h2>it's what they were made for</h2>
        </div>

        <div class="slide lonely">
            <h2>SQL helps you ask these questions in a way databases understand</h2>
        </div>

        <div class="slide lonely">
            <h2>Carto<strong>DB</strong></h2>
        </div>

        <div class="slide lonely">
            <img src="img/cartodb-table.png" />
        </div>

        <div class="slide lonely">
            <img src="img/cartodb-table-query.png" />
        </div>

        <div class="slide lonely">
            <img src="img/cartodb-table-select.png" />
        </div>

        <div class="slide lonely">
            <h2><span class="code">SELECT</span>: choose columns from a table</h2>
        </div>

        <div class="slide lonely">
            <p>just list the columns. for example:</p>
            <pre>SELECT mag, place
FROM earthquakes</pre>
        </div>

        <div class="slide lonely">
            <h2><span class="code">SELECT *</span>: choose <strong>all</strong> columns</h2>
        </div>

        <div class="slide lonely">
            <img src="img/cartodb-table-where.png" />
        </div>

        <div class="slide lonely">
            <h2><span class="code">WHERE</span>: choose rows from a table</h2>
        </div>

        <div class="slide lonely">
            <img src="img/cartodb-table-select-and-where.png" />
        </div>

        <div class="slide lonely">
            <p>for example:</p>
            <pre>SELECT *
FROM earthquakes
WHERE mag &gt; 6 
  AND mag &lt; 7</pre>
        </div>

        <div class="slide lonely">
            <p>these conditions are the same as the ones in CartoCSS:</p>
            <pre style="margin-left: 250px;">&gt;
&lt;
=
!=
&gt;=
&lt;=</pre>
        </div>

        <div class="slide lonely">
            <h2>and you combine them with <span class="code">AND</span> / <span class="code">OR</span></h2>
        </div>

        <div class="slide lonely">
            <p>for example:</p>
            <pre>SELECT *
FROM earthquakes
WHERE mag &gt; 6 
  AND place =
  'Northern Mid-Atlantic Ridge'</pre>
        </div>

        <div class="slide lonely">
            <p>for example:</p>
            <pre>SELECT *
FROM earthquakes
WHERE mag &gt; 6 
  OR place =
  'Northern Mid-Atlantic Ridge'</pre>
        </div>

        <div class="slide lonely">
            <h2>or you can negate a condition with <span class="code">NOT</span></h2>
        </div>

        <div class="slide lonely">
            <p>for example:</p>
            <pre>SELECT *
FROM earthquakes
WHERE NOT (mag &gt; 6 
  OR place =
  'Northern Mid-Atlantic Ridge')</pre>
        </div>

        <div class="slide lonely">
            <p>for example:</p>
            <pre>SELECT *
FROM earthquakes
WHERE NOT (mag &gt; 6 
  OR place =
  'Northern Mid-Atlantic Ridge')</pre>
            <p>(match any rows that <strong>do not</strong> match the condition)</p>
        </div>

        <div class="slide lonely">
            <h2><span class="code">SELECT</span> does not change the table, it only changes your view of the table</h2>
        </div>

        <div class="slide lonely">
            <h2>you can also use <span class="code">SELECT</span> to get a better idea of what data is in your table</h2>
        </div>

        <div class="slide lonely">
            <p>get a count of matching rows:</p>
            <pre>SELECT COUNT(*)
FROM earthquakes
WHERE mag &gt; 6 
  OR place =
  'Northern Mid-Atlantic Ridge'</pre>
        </div>

        <div class="slide lonely">
            <h2>but you'll almost never want to use this statement for your map</h2>
        </div>

        <div class="slide lonely">
            <img src="img/cartodb-filters-nogeom.gif" />
        </div>

        <div class="slide lonely">
            <h2>you can also use SQL to quickly <span class="code">UPDATE</span> or <span class="code">DELETE</span> the data in your table</h2>
        </div>

        <div class="slide lonely">
            <h2>these <strong>will</strong> destroy data, so have a backup or test it with a table you don't need</h2>
        </div>

        <div class="slide lonely">
            <pre>UPDATE earthquakes
SET mag_display = 'HUGE'
WHERE mag &gt; 8</pre>
        </div>

        <div class="slide lonely">
            <pre>DELETE FROM earthquakes
WHERE ...</pre>
        </div>

        <div class="slide lonely">
            <p>Much more in the SQL cheatsheet in Lore</p>
        </div>

        <!--

        SQL, Structured Query Language, is a standard language used by databases
        for pulling data from databases.

        A database is a collection of things that may or may not be related to each
        other. A table describes a particular type of things within a database.
        When you interact with a database, you need to specify a table in order to
        get what you want.

        Tables are a lot like spreadsheets. They have columns that have names and
        types (eg, string, number, geometry). When you ask for data from a table,
        you can get as little or as many of these columns as you want at once. You
        generally will only want to get the columns you actually need since this
        will be faster. Think of this as showing or hiding columns in a
        spreadsheet - this makes it easier for you to look through the spreadsheet
        for what you're looking for.

        When we want to pull from a table, we use the keyword FROM:

            FROM {table}

        This won't do anything on its own. We have to tell the database what we
        want to know about our things. Do this with SELECT:

            SELECT {attribute1, attribute2, attribute3}

        Now put it together:

            SELECT {attribute1, attribute2, attribute3}
            FROM {table}

        Nice! So SELECT restricts the columns that we receive. What if we want to
        restrict the rows that we receive? This is something spreadsheets are not
        generally good at, so it might be a little weird to think about.

        You do it with WHERE:

            WHERE {attribute1} = {value1}

        Put it all together:

            SELECT {attribute1, attribute2, attribute3}
            FROM {table}
            WHERE {attribute1} = {value1}

        Also:

            IN
            >
            <
            >=
            <=
            etc.

        (Combining WHERE conditions with AND and OR.)

        (Negating WHERE conditions with NOT.)

        -->


        <!-- SQL for spatial databases -->

        <!--

        (Add a spatial attribute to the example we've been using.)

        Geometries are often way more interesting than numbers and strings, and you
        can do so much more with them.

        (An example.)

        -->

    </body>
</html>
